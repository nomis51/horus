@inherits EntryFormBase

<MudStack Row="true"
          Spacing="1"
          AlignItems="AlignItems.Center"
          Justify="Justify.FlexStart"
          Style="margin-bottom: 1rem">
    @if (IsEditingEntryName)
    {
        <MudStack Row="true"
                  AlignItems="AlignItems.Center"
                  Style="width: 50%">
            <MudTextField T="string"
                          Placeholder="Entry name"
                          Label="Entry name"
                          FullWidth="true"
                          Adornment="Adornment.Start"
                          @bind-Value="@NewEntryName"
                          Immediate="true"
                          Required="true"
                          AdornmentIcon="@Icons.Material.Filled.Title"/>
            <MudIconButton Icon="@Icons.Material.Filled.CheckCircle"
                           OnClick="@SaveEntryName"
                           Color="Color.Success"/>
            <MudIconButton Icon="@Icons.Material.Filled.Cancel"
                           OnClick="@CancelEntryName"
                           Color="Color.Error"/>
        </MudStack>
    }
    else if (!string.IsNullOrEmpty(SelectedEntry))
    {
        <MudText Typo="Typo.h4"
                 Color="Color.Primary">
            @SelectedEntry
        </MudText>
        <MudIconButton Icon="@Icons.Material.Filled.Edit"
                       OnClick="@EditEntryName"
                       Size="Size.Small"
                       Color="Color.Primary"/>
    }
</MudStack>

@if (!string.IsNullOrEmpty(SelectedEntry))
{
    <MudStack Spacing="1"
              Row="true"
              Style="margin-bottom: .5rem"
              Justify="Justify.SpaceBetween">
        <MudText Typo="Typo.h6">Password</MudText>

        <MudStack Spacing="1"
                  Row="true">
            @if (IsPasswordReadOnly)
            {
                <MudButton StartIcon="@Icons.Material.Filled.Edit"
                           Variant="Variant.Filled"
                           Size="Size.Small"
                           OnClick="@EditPassword"
                           Color="Color.Primary">
                    Edit password
                </MudButton>
            }
            else
            {
                <MudTooltip Placement="Placement.Top"
                            Arrow="true"
                            Text="Generate a new password">
                    <MudButton StartIcon="@Icons.Material.Filled.Cached"
                               OnClick="@GenerateNewPassword"
                               Variant="Variant.Filled"
                               Size="Size.Small"
                               Disabled="@IsSaving"
                               Color="Color.Primary">
                        Generate new password
                    </MudButton>
                </MudTooltip>
                <MudButton StartIcon="@Icons.Material.Filled.Cancel"
                           Variant="Variant.Filled"
                           Size="Size.Small"
                           Disabled="@IsSaving"
                           OnClick="@CancelPassword"
                           Color="Color.Error">
                    Cancel
                </MudButton>
                <MudButton StartIcon="@Icons.Material.Filled.Save"
                           Variant="Variant.Filled"
                           Size="Size.Small"
                           OnClick="@SavePassword"
                           Disabled="@(!IsPasswordValid || IsSaving)"
                           Color="Color.Success">
                    Save
                </MudButton>
            }
        </MudStack>
    </MudStack>

    if (IsSaving)
    {
        <MudProgressCircular Color="Color.Primary"
                             Size="Size.Small"
                             Indeterminate="true"/>
    }
    else
    {
        <PasswordField @ref="PasswordFieldRef"
                       SelectedEntry="@SelectedEntry"
                       IsValid="@(e => IsPasswordValid = e)"
                       IsReadOnly="@IsPasswordReadOnly"/>
    }

    <MudStack Spacing="1"
              Row="true"
              Style="margin-top: 1rem"
              Justify="Justify.SpaceBetween">
        <MudText Typo="Typo.h6">Metadata</MudText>

        <MudStack Spacing="1"
                  Row="true">
            @if (AreMetadatasReadOnly)
            {
                <MudButton StartIcon="@Icons.Material.Filled.Visibility"
                           Variant="Variant.Filled"
                           Size="Size.Small"
                           OnClick="@EditMetadatas"
                           Color="Color.Primary">
                    Reveal metadata
                </MudButton>
            }
            else
            {
                <MudButton StartIcon="@Icons.Material.Filled.Cancel"
                           Variant="Variant.Filled"
                           Size="Size.Small"
                           Disabled="@IsSaving"
                           OnClick="@CancelMetadatas"
                           Color="Color.Error">
                    Cancel
                </MudButton>
                <MudButton StartIcon="@Icons.Material.Filled.Save"
                           Variant="Variant.Filled"
                           Size="Size.Small"
                           OnClick="@SaveMetadatas"
                           Disabled="@(!AreMetadatasValid || IsSaving)"
                           Color="Color.Success">
                    Save
                </MudButton>
            }
        </MudStack>
    </MudStack>

    if (!AreMetadatasReadOnly)
    {
        if (IsSaving || IsLoadingMetadatas)
        {
            <MudProgressCircular Color="Color.Primary"
                                 Size="Size.Small"
                                 Indeterminate="true"/>
        }

        if (!IsSaving)
        {
            <MetadataList @ref="MetadataListRef"
                          SelectedEntry="@SelectedEntry"
                          OnLoaded="@OnMetadataLoaded"
                          AreMetadatasValid="@(e => AreMetadatasValid = e)"/>
        }
    }
    else
    {
        <MudStack Spacing="2"
                  Style="margin-top: 1rem">
            @for (var i = 0; i < 6; ++i)
            {
                <MudStack Spacing="2"
                          Row="true">
                    <MudSkeleton SkeletonType="SkeletonType.Rectangle"
                                 Animation="Animation.False"
                                 Width="50%"
                                 Height="50px"/>
                    <MudSkeleton SkeletonType="SkeletonType.Rectangle"
                                 Animation="Animation.False"
                                 Width="50%"
                                 Height="50px"/>
                </MudStack>
            }
        </MudStack>
    }
}
else
{
    <MudText Typo="Typo.subtitle1">Select an entry in the left side menu or create a new one</MudText>
}